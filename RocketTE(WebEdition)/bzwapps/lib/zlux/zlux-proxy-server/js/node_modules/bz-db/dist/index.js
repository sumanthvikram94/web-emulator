if (typeof (globalThis) === 'undefined') {
    global.globalThis = global;
}
import { BlueZoneDatabase } from "./internal-db/bluezone-database.js";
import { DatabaseMetadata, SelectConstraints, BulkLoadConstraints, PersistMethod, SyncMode, PersistType, DataStrategy } from "./main/metadata.js"; // , ProcessPooling
import { DbManager } from './main/db-manager.js'; //, start
import { Logger } from './services/index.js';
import { ACTION } from './constants/actions.js';
let db_singleton;
function loadDatabase(metadata) {
    if (!db_singleton) {
        db_singleton = new DbManager(metadata);
        db_singleton.startWorker().then(() => {
            Logger.logInfo('DbManager started');
        }).catch((reason) => {
            console.error(reason);
            throw Error(reason);
        });
    }
    return db_singleton;
}
function create(metadata) {
    const db = new DbManager(metadata);
    db.startWorker().then(() => {
        Logger.logInfo('DbManager started');
    }).catch((reason) => {
        console.error(reason);
        throw Error(reason);
    });
    // const db = await start(metadata)
    return db;
}
export { DatabaseMetadata, loadDatabase, create, SelectConstraints, BulkLoadConstraints, PersistMethod, SyncMode, PersistType, DataStrategy, 
// ProcessPooling,
BlueZoneDatabase, DbManager, ACTION };
